FROM python:3.12

ENV PYTHONDONTWRITEBYTECODE=1 \
    PYTHONUNBUFFERED=1 \
    PIP_NO_CACHE_DIR=1

WORKDIR /app

# Install Python deps first (better layer caching)
COPY requirements.txt /app/requirements.txt
RUN pip install --upgrade pip && pip install -r /app/requirements.txt

# Copy application code
COPY . .

# Dev server (bind to all interfaces)
ENV PORT=5000

# Use env var interpolation for port (runtime)
CMD ["sh", "-c", "python -m flask run --host 0.0.0.0 --port ${PORT:-5000} --reload"]